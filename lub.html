<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Lubyk base module <a href="https://travis-ci.org/lubyk/lub"><img src="https://travis-ci.org/lubyk/lub.png" alt="Build Status"></a> </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">



    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="css/docs.css" rel="stylesheet">
        
  </head>

  <body>
    <div class="header">
      <div class="container">
        <div class='row'>
          <div class='span12'>
             <a href='http://lubyk.org'><img alt='lubyk logo' src='img/lubyk.png'/></a> <h1><a href='http://lubyk.org'>Lubyk</a> documentation</h1> 
          </div>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="row">

        <div class='span3 local-nav'>
          <ul class='nav nav-tabs nav-stacked affix'>
                        <li><a href='#lub'><i class='icon-chevron-right'></i> lub</a></li>
                        <li><a href='#Class-management'><i class='icon-chevron-right'></i> Class management</a></li>
                        <li><a href='#Algorithm'><i class='icon-chevron-right'></i> Algorithm</a></li>
                        <li><a href='#Filesystem'><i class='icon-chevron-right'></i> Filesystem</a></li>
                        <li><a href='#Strings,-Arrays'><i class='icon-chevron-right'></i> Strings, Arrays</a></li>
                        <li><a href='#Debugging'><i class='icon-chevron-right'></i> Debugging</a></li>
                        <li><a href='#Miscellanous'><i class='icon-chevron-right'></i> Miscellanous</a></li>
                        <li><a href='#Classes'><i class='icon-chevron-right'></i> Classes</a></li>
                        <li><a href='#FIXME'><i class='icon-chevron-right'></i> FIXME</a></li>
                      </ul>
        </div>

        <div class='main span7'>

                    <section id='lub'>
          <h2 class='section'>Lubyk base module <a href="https://travis-ci.org/lubyk/lub"><img src="https://travis-ci.org/lubyk/lub.png" alt="Build Status"></a> </h2>

                    
                    <p class='summary'>Currently, this module contains core functions (code loading, templates,  helpers).</p>
                    <a href="https://github.com/lubyk/lub"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a>
                    <p>This module is part of the <a href='http://lubyk.org'>lubyk</a> project. <strong>MIT license</strong> &copy; Gaspard Bucher 2014.</p>
                    <h4 class='sub-title'>Installation</h4>
                    <p>With <a href='http://luarocks.org'>luarocks</a>:</p>
                    <pre class='prettyprint lang-lua'>$ luarocks install lub
</pre>
                    <p>With <a href='http://luadist.org'>luadist</a>:</p>
                    <pre class='prettyprint lang-lua'>$ luadist install lub
</pre>
                              
                    <h4 class='sub-title'>Dependencies</h4>
                    <table class='definition'>
  <tr><td class='key'>lfs</td><td>luafilesystem</td></tr>

</table>
                                        <h4 id='VERSION' class='entry param'><span>.</span>VERSION <code>= '1.0.3'</code></h4>
          
                    <p>Current version respecting <a href='http://semver.org'>semantic versioning</a>.</p>
                              
                    <h4 id='DEPENDS' class='entry param'><span>.</span>DEPENDS = {</h4>
                                        <h4 id='' class='entry lparam'><code>"lua >= 5.1, < 5.3"</code></h4>
          
                    <p>Compatible with Lua 5.1, 5.2 and LuaJIT</p>
                                        <h4 id='' class='entry lparam'><code>"luafilesystem >= 1.5.0"</code></h4>
          
                    <p>Uses <a href='http://keplerproject.github.io/luafilesystem/'>Lua Filesystem</a></p>
                              
                    <h4 class='entry attrib'>}</h4>
                    <p class='fixme'><span>FIXME</span> We need to have lub.plat contain current platform name such as 'macosx', 'linux' or 'win32'</p>
                              </section>
                    <section id='Class-management'>
          <h2 class='section'>Class management</h2>

                              <h4 id='class' class='entry function'><span>.</span>class <code>(class_name, tbl)</code></h4>
          
                    <p>Declare a new class with the following conventions:</p>
                    <ul>
<li>The <code>.type</code> field contains the full class name.</li>
<li>The returned table is the metatable for all instances of this class and contains the functions.</li>
<li>Calling the table with <code>foo.Bar()</code> is an alias for a call to <code>foo.Bar.new</code>.</li>
</ul>
                    <p>Usage:</p>
                    <pre class='prettyprint lang-lua'>local lub = require 'lub'
local lib = lub.class 'lub.Doc'
-- ...
return lib</pre>
                              </section>
                    <section id='Algorithm'>
          <h2 class='section'>Algorithm</h2>

                    
                                        <h4 id='search' class='entry function'><span>.</span>search <code>(data, func, max_depth)</code></h4>
          
                    <p>Search a tree using lua function for node testing or collecting. This method is an alias for <a href='#BFS'>BFS</a>.</p>
                    <p>Optional argument <code>max_depth</code> is to avoid hanging in case the data contains loops. The default value for <code>max_depth</code> is 3000.</p>
                    <p>If the function <code>func</code> used for testing returns any value different from false or nil, the search is terminated and this value is returned.</p>
                    <p>Example to find an element in an xml tree:</p>
                    <pre class='prettyprint lang-lua'>local poor_guy = lub.search(data, function(node)
  if node.xml == 'Person' and node.status == 'poor' then
    return node
  end
end)
</pre>
                    <p>Example to collect elements:</p>
                    <pre class='prettyprint lang-lua'>local list = {}
lub.search(data, function(node)
  if node.xml == 'Person' then
    table.insert(list, node)
  end
end 
</pre>
                    <h4 class='sub-title'>Speed</h4>
                    <p>The traversal speed depends on whether we are using Lua or LuaJIT. The tests below were done on a relatively large medical XML file without very deep nesting.</p>
                    <pre class='txt ascii'>===== Lua
IDDFS     5.10
BFS       2.58
===== LuaJIT
IDDFS     0.30
BFS       0.36</pre>
                                        <h4 id='IDDFS' class='entry function'><span>.</span>IDDFS <code>(data, func, max_depth)</code></h4>
          
                    <p><a href='https://en.wikipedia.org/wiki/Iterative_deepening_depth-first_search'>Iterative deepening depth-first search</a> with max depth testing. See <a href='#search'>search</a> for usage.</p>
                                        <h4 id='BFS' class='entry function'><span>.</span>BFS <code>(data, func, max_depth)</code></h4>
          
                    <p><a href='https://en.wikipedia.org/wiki/Breadth-first_search'>Breath-first search</a> with max depth testing. See <a href='#search'>search</a> for usage.</p>
                              </section>
                    <section id='Filesystem'>
          <h2 class='section'>Filesystem</h2>

                    
                                        <h4 id='path' class='entry function'><span>.</span>path <code>(path, level)</code></h4>
          
                    <p>Return a path by resolving special initial characters:</p>
                    <table class='definition'>
  <tr><td class='key'><code>/</code>   </td><td>absolute path, resolves '..' in path.</td></tr>
  <tr><td class='key'><code>|</code>   </td><td>path relative to script directory, resolves '..' in path.</td></tr>
  <tr><td class='key'><code>&</code>   </td><td>returns current script path.</td></tr>

</table>
                    <p>For example:</p>
                    <pre class='prettyprint lang-lua'>print(lub.path '|')
--&gt; current script directory

print(lub.path '|..')
--&gt; parent of script directory
</pre>
                                        <h4 id='fileType' class='entry function'><span>.</span>fileType <code>(path)</code></h4>
          
                    <p>Test for file/directory existence at <code>path</code>. If the element exists, returns the file type such as <strong>'directory'</strong> or <strong>'file'</strong>. Returns nil if there is nothing at the given path.</p>
                                        <h4 id='exist' class='entry function'><span>.</span>exist <code>(path)</code></h4>
          
                    <p>Return true if the file or folder pointed by <code>path</code> exists.</p>
                                        <h4 id='content' class='entry function'><span>.</span>content <code>(basepath, path)</code></h4>
          
                    <p>Return the content of a file as a lua string (not suitable for very long content where parsing the file chunks by chunks is better). The method accepts either a single <code>path</code> argument or a <code>basepath</code> and relative <code>path</code>.</p>
                                        <h4 id='writeall' class='entry function'><span>.</span>writeall <code>(filepath, data, check_diff)</code></h4>
          
                    <p>Write <code>data</code> to <code>filepath</code>, creating path folders if necessary. If <code>check_diff</code> is true, only write if the content has changed to avoid changing stat information on the file.</p>
                                        <h4 id='makePath' class='entry function'><span>.</span>makePath <code>(path)</code></h4>
          
                    <p>Build necessary folders to create a given <code>path</code>.</p>
                                        <h4 id='move' class='entry function'><span>.</span>move <code>(path, new_path)</code></h4>
          
                    <p>Move a file or directory from <code>path</code> to <code>new_path</code>. This is like "os.rename" but it also builds necessary path components in new_path.</p>
                                        <h4 id='copy' class='entry function'><span>.</span>copy <code>(path, new_path)</code></h4>
          
                    <p>Copy a file from <code>path</code> to <code>new_path</code>. Builds necessary path components in new_path.</p>
                                        <h4 id='rmFile' class='entry function'><span>.</span>rmFile <code>(path)</code></h4>
          
                    <p>Delete the file located at <code>path</code>. Does nothing if the element at <code>path</code> does not exist (already removed).</p>
                                        <h4 id='rmTree' class='entry function'><span>.</span>rmTree <code>(path, recursive)</code></h4>
          
                    <p>Remove the directory at <code>path</code>. If <code>recursive</code> is true, remove recursively. <strong>This is a dangerous method</strong> if the source path is not ensured to be exempt of mistakes.</p>
                                        <h4 id='dir' class='entry function'><span>.</span>dir <code>(filepath)</code></h4>
          
                    <p>Return the parent folder and filename from a <code>filepath</code>. Usage:</p>
                    <pre class='prettyprint lang-lua'>local base, file = lub.dir(filepath)
</pre>
                    <p>This can also be used on urls.</p>
                                        <h4 id='absolutizePath' class='entry function'><span>.</span>absolutizePath <code>(path, basepath)</code></h4>
          
                    <p>Return an absolute path from a <code>path</code> and optional <code>basepath</code>. If basepath is not provided, the method uses the current directory. This method resolves <code>/../</code> and <code>/./</code> in paths and returns a clean path. Can also be used with urls.</p>
                    <p>For example:</p>
                    <pre class='prettyprint lang-lua'>local abs_path = lub.absolutizePath('foo/bar/../baz', '/home')
--&gt; '/home/foo/baz'</pre>
                                        <h4 id='absToRel' class='entry function'><span>.</span>absToRel <code>(abs_string, base)</code></h4>
          
                    <p>Transform an absolute path or url to a relative path with given base. For  example:</p>
                    <pre class='prettyprint lang-lua'>local rel = lub.absToRel('/home/foo/bar', '/home/foo/baz')
--&gt; '/home/foo/bar'
local rel = lub.absToRel('/home/foo/bar', '/home/foo')
--&gt; 'bar'</pre>
                              </section>
                    <section id='Strings,-Arrays'>
          <h2 class='section'>Strings, Arrays</h2>

                    
                                        <h4 id='strip' class='entry function'><span>.</span>strip <code>(str)</code></h4>
          
                    <p>Removes white spaces at the beginning and end of the string <code>str</code>.</p>
                                        <h4 id='split' class='entry function'><span>.</span>split <code>(str, pat)</code></h4>
          
                    <p>Split a string <code>str</code> into elements separated by the pattern <code>pat</code>. The function returns a table.</p>
                    <pre class='prettyprint lang-lua'>local t = lub.split('foo/bar/baz', '/')
--&gt; {'foo', 'bar', 'baz'}</pre>
                                        <h4 id='join' class='entry function'><span>.</span>join <code>(list, sep)</code></h4>
          
                    <p>Join elements of a table <code>list</code> with separator <code>sep</code>. Returns a string.</p>
                    <pre class='prettyprint lang-lua'>local x = lub.join({'foo', 'bar', 'baz'}, '.')
--&gt; 'foo.bar.baz'</pre>
                                        <h4 id='insertSorted' class='entry function'><span>.</span>insertSorted <code>(list, elem, key)</code></h4>
          
                    <p>Insert <code>elem</code> into a <code>list</code>, keeping entries in "list" sorted. If elem is not a string, the <code>elem[key]</code> is used to get a string for sorting.</p>
                                        <h4 id='merge' class='entry function'><span>.</span>merge <code>(source, table)</code></h4>
          
                    <p>Merge values in <code>table</code> inside <code>source</code>. All keys are considered (array and hash).</p>
                                        <h4 id='deepMerge' class='entry function'><span>.</span>deepMerge <code>(base, key, value)</code></h4>
          
                    <p>Deep merge <code>value</code> into <code>base</code> at <code>key</code>. Returns true if <strong>base</strong> has been changed. For example:</p>
                    <pre class='prettyprint lang-lua'>local base = {a = { b = 4, c = 5 }}
lub.deepMerge(base, 'a', { c = 5 })
--&gt; false (nothing changed)

lub.deepMerge(base, 'a', { c = 6 })
--&gt; true, base = {a = { b = 4, c = 6 }}</pre>
                              </section>
                    <section id='Debugging'>
          <h2 class='section'>Debugging</h2>

                    
                                        <h4 id='traceRequire' class='entry function'><span>.</span>traceRequire <code>(enable)</code></h4>
          
                    <p>Print calls to <code>require</code>. This can be used to list all code dependencies. Usage:</p>
                    <pre class='prettyprint lang-lua'>lub.traceRequire(true)
-- From now on, all require statements are printed.
</pre>
                    <p>If you simply want to make sure no require is not called to autoload code after some point, you should use <a href='Autoload.html#strict'>Autoload.strict</a>.</p>
                                        <h4 id='log' class='entry function'><span>.</span>log <code>(...)</code></h4>
          
                    <p>Print a log message with the current file name and line. This is better then using "print" because it gives us some information on the context of the  print statement.</p>
                    <pre class='prettyprint lang-lua'>lub.log('foo')
--&gt; lub/util.lua:426:  foo</pre>
                              </section>
                    <section id='Miscellanous'>
          <h2 class='section'>Miscellanous</h2>

                    
                                        <h4 id='deprecation' class='entry function'><span>.</span>deprecation <code>(lib_name, old, new, ...)</code></h4>
          
                    <p>Declare a method as being deprecated. This should be used when method names are changed to avoid breaking code without warnings. The syntax is:</p>
                    <pre class='prettyprint lang-lua'>function lib.badName(...)
  return lib.deprecation('lub', 'badName', 'betterName', ...)
end
</pre>
                    <p>When someone uses the "badName" method, a deprecation warning is printed:</p>
                    <pre class='prettyprint lang-lua'>[DEPRECATION] {traceback}
    'lub.badName' is deprecated. Please use 'lub.betterName' instead.</pre>
                                        <h4 id='shellQuote' class='entry function'><span>.</span>shellQuote <code>(str)</code></h4>
          
                    <p>Quote string <code>str</code> so that it can be inserted in a shell command. Example:</p>
                    <pre class='prettyprint lang-lua'>os.execute(string.format('latex %s', lub.shellQuote(filepath)))</pre>
                              </section>
                    <section id='Classes'>
          <h2 class='section'>Classes</h2>

                    
                    <p class='warn'><span>WARN</span> We are currently migrating content from <a href='lk.html'>lk</a> module. Not all classes have been migrated and documented.</p>
                                        <h4 id='------------' class='entry klass'><a href='lub.Autoload.html'>Autoload</a></h4>
          
                    <p class='summary'>This class creates a module table that will automatically call require to find new keys. This enables "load as needed" code. If the required code cannot be found, generates an error.</p>
                                        <h4 id='-------' class='entry klass'><a href='lub.Dir.html'>Dir</a></h4>
          
                    <p class='summary'>This is a helper to access/glob directory trees. It requires 'lfs' (lua filesystem).</p>
                                        <h4 id='------------' class='entry klass'><a href='lub.Template.html'>Template</a></h4>
          
                    <p class='summary'>Simplistic templating system inspired by Zed A. Shaw's minimal template for <a href='http://mongrel2.org/'>Tir</a>.</p>
                              </section>
                    <section id='FIXME'>
          <h2 class='section'>FIXME</h2>

                    
                    <p class='fixme'><span class='ref'><a href='#lub'>lub</a></span><span>FIXME</span> We need to have lub.plat contain current platform name such as 'macosx', 'linux' or 'win32'</p>
                              </section>
                  </div>

        <div class='span2 global-nav'>
          <ul class='nav nav-tabs nav-stacked'>
                        <li class='module'><a href='index.html'><span></span>lub</a></li>
            
                        <li class=''><a href='lub.Autoload.html'>Autoload</a></li>
                        <li class=''><a href='lub.Dir.html'>Dir</a></li>
                        <li class=''><a href='lub.Template.html'>Template</a></li>
                      </ul>
        </div>
      </div>
    </div>

    <footer class="footer">
    <div class="container">
       made with <a title='last change: b16091e 2014-01-25 18:41:03 +0100' href='http://doc.lubyk.org/lut.Doc.html'>lut.Doc</a> 
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39725130-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

    </div>
    </footer>

    <script src='https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=lua&skin=default'></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        config: ["MMLorHTML.js"],
        jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML"],
        extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js"],
        TeX: {
          extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
        },
        displayAlign: "left",
        menuSettings: {
          zoom: "Hover",
          mpContext: true,
          mpMouse: true
        },
      });
    </script>
    <script type="text/javascript"
      src='https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js'></script>
    <script src='http://code.jquery.com/jquery.min.js'></script>
    <script src='js/bootstrap.min.js'></script>
  </body>
</html>

